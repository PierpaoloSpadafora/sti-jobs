<div class="schedule-container">
  <h2>Jobs da schedulare</h2>
  <div class="jobs-container">
    <div class="table-responsive">
      <table class="jobs-table">
        <thead>
        <tr>
          <th>Titolo</th>
          <th>Descrizione</th>
          <th>Durata</th>
          <th>Azioni</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let job of paginatedJobs">
          <td>{{ job.title }}</td>
          <td>{{ job.description }}</td>
          <td>{{ secondsToDuration(Number(job.duration)) }}</td>
          <td class="actions-cell">
            <button class="action-button edit" title="Schedula" (click)="openScheduleDialog(job)">
              <i class="fas fa-calendar-plus"></i>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination-controls">
      <button
        class="pagination-button"
        (click)="previousJobPage()"
        [disabled]="currentJobPage === 1">
        Precedente
      </button>
      <span>Pagina {{currentJobPage}} di {{totalJobPages}}</span>
      <button
        class="pagination-button"
        (click)="nextJobPage()"
        [disabled]="currentJobPage === totalJobPages">
        Successiva
      </button>
    </div>
  </div>

  <div class="schedules-container">
    <h2>Elenco dei Job Schedulati</h2>
    <div class="table-responsive">
      <table class="schedules-table">
        <thead>
        <tr>
          <th>Job ID</th>
          <th>Tipo Macchina</th>
          <th>Ora di Inizio</th>
          <th>Data di Scadenza</th>
          <th>Durata</th>
          <th>Stato</th>
          <th>Azioni</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let schedule of paginatedSchedules">
          <td>{{ schedule.jobId }}</td>
          <td>{{ schedule.machineTypeId }}</td>
          <td>{{ schedule.startTime | date: 'short' }}</td>
          <td>{{ schedule.dueDate | date: 'short' }}</td>
          <td>{{ secondsToDuration(schedule.duration) }}</td>
          <td>{{ schedule.status }}</td>
          <td class="actions-cell">
            <button class="action-button edit" title="Modifica" (click)="openEditScheduleDialog(schedule)">
              <i class="fas fa-edit"></i>
            </button>
            <button class="action-button delete" title="Elimina" (click)="confirmDeleteSchedule(schedule)">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination-controls">
      <button
        class="pagination-button"
        (click)="previousSchedulePage()"
        [disabled]="currentSchedulePage === 1">
        Precedente
      </button>
      <span>Pagina {{currentSchedulePage}} di {{totalSchedulePages}}</span>
      <button
        class="pagination-button"
        (click)="nextSchedulePage()"
        [disabled]="currentSchedulePage === totalSchedulePages">
        Successiva
      </button>
    </div>
  </div>
</div>

<ng-template #scheduleDialog let-data>
  <h2 mat-dialog-title>Schedula Job: {{ data.job.title }}</h2>
  <mat-dialog-content [formGroup]="scheduleForm">
    <div class="form-field">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Ora di Inizio</mat-label>
        <mat-select formControlName="startTime" (selectionChange)="onStartTimeChange()" required [compareWith]="compareDate">
          <mat-option *ngFor="let time of availableStartTimes" [value]="time">
            {{ time | date: 'shortTime' }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="form-field">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Ora di Fine</mat-label>
        <input matInput [value]="calculatedEndTime | date: 'shortTime'" readonly>
      </mat-form-field>
    </div>

    <div class="form-field">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Data di Scadenza</mat-label>
        <input matInput [matDatepicker]="dueDatePicker" formControlName="dueDate" required>
        <mat-datepicker-toggle matSuffix [for]="dueDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #dueDatePicker></mat-datepicker>
      </mat-form-field>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button (click)="dialogRef.close()">Cancella</button>
    <button mat-button color="primary" [disabled]="scheduleForm.invalid" (click)="scheduleJob()">Schedula</button>
  </mat-dialog-actions>
</ng-template>
